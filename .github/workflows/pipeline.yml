name: Deployment pipeline

on:
  push:
    branches:
      - main

jobs:
    simple_deployment_pipeline:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                node-version: '20'
            
            # Install dependencies
            - name: Install dependencies
              run: npm install

            # Lint code
            - name: Check style
              run: npm run eslint

            # Build project
            - name: Build project
              run: npm run build

            # Run tests
            - name: Run tests
              run: npm test
                
            # Run Playwright end-to-end tests
            - name: Run e2e tests
              uses: cypress-io/github-action@v5  # works with Playwright too if configured
              with:
                command: npm run test:e2e      # your Playwright test command
                start: npm run start-prod      # start production server
                wait-on: http://localhost:5000 # wait until server is ready